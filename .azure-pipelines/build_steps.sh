# PLEASE NOTE: This script has been automatically generated by conda-smithy. Any changes here
# will be lost next time ``conda smithy rerender`` is run. If you would like to make permanent
# changes to this script, consider a proposal to conda-smithy so that other feedstocks can also
# benefit from the improvement.

set -xeuo pipefail
export PYTHONUNBUFFERED=1
export MULTIDICT_ROOT=$(cd "$(dirname "$0")/.."; pwd;)

cat >~/.condarc <<CONDARC

conda-build:
 root-dir: ${MULTIDICT_ROOT}/build_artifacts

CONDARC

yum update -y
yum install gcc gcc-c++ python3-devel wget make enchant-devel -y
export CONDA_ENV='azure'
cd '/home/conda/multidict_root'
echo "Installing miniforge"
bash .azure-pipelines/install_conda_aarch64.sh
export PATH='/opt/conda/bin':${PATH}
echo "Installing requirement"
pip install -r requirements/lint.txt
make flake8
pip install -e .
export MULTIDICT_NO_EXTENSIONS='1'
make mypy
pip install -r requirements/doc-spelling.txt
pip install -r requirements/towncrier.txt
towncrier --yes
pip install -U twine wheel
python setup.py sdist bdist_wheel
twine check dist/*
echo "#################################### Dist LS #################################"
ls dist
tar -xvf dist/multidict-4.7.6.tar.gz
python -m pip install --upgrade pip setuptools wheel
python setup.py install
python -m pip install -r requirements/pytest.txt
python -m pip install pytest-azurepipelines
python -m pytest tests -vv
python -m coverage xml
python -m pip install codecov
python -m codecov -f coverage.xml -X gcov
echo "test complete"
